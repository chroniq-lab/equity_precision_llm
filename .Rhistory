library(tidyverse)
rm(list=ls());gc();source(".Rprofile")
training <- readxl::read_excel(paste0(path_equity_precision_llm_folder,"/llm training/Methods.xlsx"),sheet="Training")
training <- readxl::read_excel(paste0(path_equity_precision_llm_folder,"/llm training/Methods.xlsx"),sheet="Training Data")
View(training)
source("C:/code/external/equity_precision_llm/.Rprofile", echo=TRUE)
all_abstracts <- readRDS(paste0(path_equity_precision_llm_folder,"/working/cleaned/epdat02_harmonized datasets.RDS"))
all_abstracts <- readRDS(paste0(path_ep_folder,"/working/cleaned/epdat02_harmonized datasets.RDS"))
View(all_abstracts)
names(training)
View(training)
all_abstracts <- readRDS(paste0(path_ep_folder,"/working/cleaned/epdat02_harmonized datasets.RDS")) %>%
dplyr::filter(!pmid %in% training$PMID)
all_abstracts <- readRDS(paste0(path_ep_folder,"/working/cleaned/epdat02_harmonized datasets.RDS")) %>%
dplyr::filter(!PMID %in% training$PMID)
development <- all_abstracts %>%
sample_n(size = 100)
View(development)
test <- all_abstracts %>%
dplyr::filter(!PMID %in% development$PMID)
set.seed(20241115)
development <- all_abstracts %>%
sample_n(size = 100)
test <- all_abstracts %>%
dplyr::filter(!PMID %in% development$PMID)
write_csv(development,paste0(path_equity_precision_llm_folder,"/llm training/Development Data.csv"))
write_csv(test,paste0(path_equity_precision_llm_folder,"/llm training/Test Data.csv"))
rm(list=ls());gc();source(".Rprofile")
training <- readxl::read_excel(paste0(path_equity_precision_llm_folder,"/llm training/Methods.xlsx"),sheet="Training Data")
all_abstracts <- readRDS(paste0(path_ep_folder,"/working/cleaned/epdat02_harmonized datasets.RDS")) %>%
dplyr::filter(!PMID %in% training$PMID)
View(all_abstracts)
all_files_df <- readRDS(paste0(path_ep_folder,"/working/cleaned/epdat03_all abstracts.RDS"))
View(all_files_df)
View(all_abstracts)
rm(list=ls());gc();source(".Rprofile")
all_files_df <- readRDS(paste0(path_ep_folder,"/working/cleaned/epdat03_all abstracts.RDS"))
development <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Development Data.csv"))
test <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Test Data.csv"))
development <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Development Data.csv")) %>%
left_join(all_files_df %>%
dplyr::select(pmid,abstract),
by=c("pmid"))
development <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Development Data.csv")) %>%
left_join(all_files_df %>%
dplyr::select(pmid,abstract),
by=c("PMID"="pmid"))
development <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Development Data.csv")) %>%
left_join(all_files_df %>%
dplyr::select(pmid,abstract) %>%
mutate(pmid = as.numeric(pmid)),
by=c("PMID"="pmid"))
View(development)
rm(list=ls());gc();source(".Rprofile")
abstract <- readRDS(paste0(path_ep_folder,"/working/cleaned/eppre02_all abstracts_abstracts.RDS"))
abstract <- bind_rows(
readRDS(paste0(path_ep_folder,"/working/cleaned/eppre02_all abstracts_abstracts part 1.RDS")),
readRDS(paste0(path_ep_folder,"/working/cleaned/eppre02_all abstracts_abstracts part 2.RDS")))
readRDS(paste0(path_ep_folder,"/working/cleaned/eppre02_all abstracts_abstracts part 1.RDS"))
abstract <- bind_rows(
readRDS(paste0(path_ep_folder,"/working/cleaned/eppre02_all abstracts_abstracts part1.RDS")),
readRDS(paste0(path_ep_folder,"/working/cleaned/eppre02_all abstracts_abstracts part2.RDS")))
abstract <- bind_rows(
readRDS(paste0(path_ep_folder,"/working/cleaned/eppre02_all abstracts_abstracts part1.RDS")),
readRDS(paste0(path_ep_folder,"/working/cleaned/eppre02_all abstracts_abstracts part2.RDS")))
mesh <- bind_rows(
readRDS(paste0(path_ep_folder,"/working/cleaned/eppre02_all abstracts_mesh part1.RDS")),
readRDS(paste0(path_ep_folder,"/working/cleaned/eppre02_all abstracts_mesh part2.RDS")))
development <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Development Data.csv")) %>%
left_join(abstract %>%
dplyr::select(pmid,abstract) %>%
mutate(pmid = as.numeric(pmid)),
by=c("PMID"="pmid"))
View(development)
View(mesh)
mesh <- bind_rows(
readRDS(paste0(path_ep_folder,"/working/cleaned/eppre02_all abstracts_mesh part1.RDS")),
readRDS(paste0(path_ep_folder,"/working/cleaned/eppre02_all abstracts_mesh part2.RDS"))) %>%
group_by(pmid) %>%
summarize(MeSH = paste0(DescriptorName,collapse=","))
View(mesh)
epan03 <- readRDS(paste0(path_ep_folder,"/working/cleaned/epan03_abstracts.RDS"))
View(epan03)
epan03 <- readRDS(paste0(path_ep_folder,"/working/cleaned/epan03_mesh.RDS"))
View(mesh)
epan03 <- readRDS(paste0(path_ep_folder,"/working/cleaned/epan03_mesh.RDS")) %>%
group_by(pmid) %>%
summarize(MeSH = paste0(MeSH,collapse=","))
View(epan03)
epan03 <- readRDS(paste0(path_ep_folder,"/working/cleaned/epan03_mesh.RDS")) %>%
group_by(pmid) %>%
summarize(MeSH = paste0(DescriptorName,collapse=","))
epan03_abstracts <- readRDS(paste0(path_ep_folder,"/working/cleaned/epan03_abstracts.RDS"))
epan03_mesh <- readRDS(paste0(path_ep_folder,"/working/cleaned/epan03_mesh.RDS")) %>%
group_by(pmid) %>%
summarize(MeSH = paste0(DescriptorName,collapse=","))
View(epan03_abstracts)
development <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Development Data.csv")) %>%
left_join(epan03_mesh %>%
dplyr::select(pmid,abstract) %>%
rename(epan03_abstract = abstract) %>%
mutate(pmid = as.numeric(pmid)),
by=c("PMID"="pmid"))
development <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Development Data.csv")) %>%
left_join(epan03_abstracts %>%
dplyr::select(pmid,abstract) %>%
rename(epan03_abstract = abstract) %>%
mutate(pmid = as.numeric(pmid)),
by=c("PMID"="pmid"))
View(development)
View(mesh)
development <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Development Data.csv")) %>%
left_join(epan03_abstracts %>%
dplyr::select(pmid,abstract) %>%
rename(epan03_abstract = abstract) %>%
mutate(pmid = as.numeric(pmid)),
by=c("PMID"="pmid")) %>%
left_join(epan03_mesh,
by=c("PMID"="pmid"))
names(development)
development <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Development Data.csv")) %>%
left_join(epan03_abstracts %>%
dplyr::select(pmid,abstract) %>%
rename(epan03_abstract = abstract) %>%
mutate(pmid = as.numeric(pmid)),
by=c("PMID"="pmid")) %>%
left_join(epan03_mesh,
by=c("PMID"="pmid")) %>%
mutate(Abstract = case_when(is.na(abstract) & !is.na(epan03_abstract) ~ epan03_abstract,
TRUE ~ ""),
MeSH = case_when(is.na(MeSH) | MeSH == "NA" ~ ""))
View(development)
development <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Development Data.csv")) %>%
left_join(epan03_abstracts %>%
dplyr::select(pmid,abstract) %>%
rename(epan03_abstract = abstract) %>%
mutate(pmid = as.numeric(pmid)),
by=c("PMID"="pmid")) %>%
left_join(epan03_mesh,
by=c("PMID"="pmid")) %>%
mutate(Abstract = case_when(is.na(abstract) & !is.na(epan03_abstract) ~ epan03_abstract,
TRUE ~ ""),
MeSH = case_when(is.na(MeSH) | MeSH == "NA" ~ "")) %>%
rename('Precision Medicine' = h_precision_medicine,
'Diabetes' = h_is_diabetes,
'Source Population' = gbd_region,
'Correct Source Population' = h_correct_population,
'Primary Study' = h_primary_study
)
development <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Development Data.csv")) %>%
left_join(epan03_abstracts %>%
dplyr::select(pmid,abstract) %>%
rename(epan03_abstract = abstract) %>%
mutate(pmid = as.numeric(pmid)),
by=c("PMID"="pmid")) %>%
left_join(epan03_mesh,
by=c("PMID"="pmid")) %>%
mutate(Abstract = case_when(is.na(abstract) & !is.na(epan03_abstract) ~ epan03_abstract,
TRUE ~ ""),
MeSH = case_when(is.na(MeSH) | MeSH == "NA" ~ "")) %>%
rename('Precision Medicine' = h_precision_medicine,
'Diabetes' = h_is_diabetes,
'Source Population' = gbd_region,
'Correct Source Population' = h_correct_population,
'Primary Study' = h_primary_study
) %>%
dplyr::select(PMID,Title,Abstract,MeSH,one_of(c('Source Population','Precision Medicine','Diabetes','Correct Source Population','Primary Study')))
View(development)
development <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Development Data.csv")) %>%
left_join(epan03_abstracts %>%
dplyr::select(pmid,abstract) %>%
rename(epan03_abstract = abstract) %>%
mutate(pmid = as.numeric(pmid)),
by=c("PMID"="pmid")) %>%
left_join(epan03_mesh,
by=c("PMID"="pmid")) %>%
mutate(Abstract = case_when(!is.na(abstract) ~ abstract,
is.na(abstract) & !is.na(epan03_abstract) ~ epan03_abstract,
TRUE ~ ""),
MeSH = case_when(is.na(MeSH) | MeSH == "NA" ~ "")) %>%
rename('Precision Medicine' = h_precision_medicine,
'Diabetes' = h_is_diabetes,
'Source Population' = gbd_region,
'Correct Source Population' = h_correct_population,
'Primary Study' = h_primary_study
) %>%
dplyr::select(PMID,Title,Abstract,MeSH,one_of(c('Source Population','Precision Medicine','Diabetes','Correct Source Population','Primary Study')))
View(development)
writexl::write_xlsx(development,paste0(path_equity_precision_llm_folder,"/llm training/Development Data.xlsx"))
writexl::write_xlsx(test,paste0(path_equity_precision_llm_folder,"/llm training/Test Data.xlsx"))
test <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Test Data.csv")) %>%
left_join(epan03_abstracts %>%
dplyr::select(pmid,abstract) %>%
rename(epan03_abstract = abstract) %>%
mutate(pmid = as.numeric(pmid)),
by=c("PMID"="pmid")) %>%
left_join(epan03_mesh,
by=c("PMID"="pmid")) %>%
mutate(Abstract = case_when(!is.na(abstract) ~ abstract,
is.na(abstract) & !is.na(epan03_abstract) ~ epan03_abstract,
TRUE ~ ""),
MeSH = case_when(is.na(MeSH) | MeSH == "NA" ~ "")) %>%
rename('Precision Medicine' = h_precision_medicine,
'Diabetes' = h_is_diabetes,
'Source Population' = gbd_region,
'Correct Source Population' = h_correct_population,
'Primary Study' = h_primary_study
) %>%
dplyr::select(PMID,Title,Abstract,MeSH,one_of(c('Source Population','Precision Medicine','Diabetes','Correct Source Population','Primary Study')))
writexl::write_xlsx(test,paste0(path_equity_precision_llm_folder,"/llm training/Test Data.xlsx"))
rm(list=ls());gc();source(".Rprofile")
epdat03 <- readRDS(paste0(path_ep_folder,"/working/cleaned/epdat03_all abstracts.RDS"))
epan03_abstracts <- readRDS(paste0(path_ep_folder,"/working/cleaned/epan03_abstracts.RDS"))
epan03_mesh <- readRDS(paste0(path_ep_folder,"/working/cleaned/epan03_mesh.RDS")) %>%
group_by(pmid) %>%
summarize(MeSH = paste0(DescriptorName,collapse=","))
development <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Development Data.csv")) %>%
left_join(epan03_abstracts %>%
dplyr::select(pmid,abstract) %>%
rename(epan03_abstract = abstract) %>%
mutate(pmid = as.numeric(pmid)),
by=c("PMID"="pmid")) %>%
left_join(epan03_mesh,
by=c("PMID"="pmid")) %>%
mutate(Abstract = case_when(!is.na(abstract) ~ abstract,
is.na(abstract) & !is.na(epan03_abstract) ~ epan03_abstract,
TRUE ~ ""),
MeSH = case_when(is.na(MeSH) | MeSH == "NA" ~ "")) %>%
rename('Precision Medicine' = h_precision_medicine,
'Diabetes' = h_is_diabetes,
'Source Population' = gbd_region,
'Correct Source Population' = h_correct_population,
'Primary Study' = h_primary_study
) %>%
dplyr::select(PMID,Title,Abstract,MeSH,one_of(c('Source Population','Precision Medicine','Diabetes','Correct Source Population','Primary Study')))
test <- read_csv(paste0(path_equity_precision_llm_folder,"/llm training/Test Data.csv")) %>%
left_join(epan03_abstracts %>%
dplyr::select(pmid,abstract) %>%
rename(epan03_abstract = abstract) %>%
mutate(pmid = as.numeric(pmid)),
by=c("PMID"="pmid")) %>%
left_join(epan03_mesh,
by=c("PMID"="pmid")) %>%
mutate(Abstract = case_when(!is.na(abstract) ~ abstract,
is.na(abstract) & !is.na(epan03_abstract) ~ epan03_abstract,
TRUE ~ ""),
MeSH = case_when(is.na(MeSH) | MeSH == "NA" ~ "")) %>%
rename('Precision Medicine' = h_precision_medicine,
'Diabetes' = h_is_diabetes,
'Source Population' = gbd_region,
'Correct Source Population' = h_correct_population,
'Primary Study' = h_primary_study
) %>%
dplyr::select(PMID,Title,Abstract,MeSH,one_of(c('Source Population','Precision Medicine','Diabetes','Correct Source Population','Primary Study')))
writexl::write_xlsx(development,paste0(path_equity_precision_llm_folder,"/llm training/Development Data.xlsx"))
writexl::write_xlsx(test,paste0(path_equity_precision_llm_folder,"/llm training/Test Data.xlsx"))
table(is.na(epan03_abstracts$abstract))
